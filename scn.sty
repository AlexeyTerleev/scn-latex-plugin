\NeedsTeXFormat{LaTeX2e}[2021-06-01]
\ProvidesPackage{scn-latex-plugin/scn}
  [2022/07/26 v0.1.0 LaTeX package for SCn-code support]

\RequirePackage[utf8]{inputenc}
\RequirePackage[T2A]{fontenc}
\RequirePackage[russian]{babel}
%DEFINES START

\newcommand{\showfont}{encoding: \f@encoding{}, family: \f@family{}, series: \f@series{}, shape: \f@shape{}, size: \f@size{}}

\newcommand\tabsize{3em}

\newlength{\insize}
\setlength{\insize}{0.7em}

\newlength{\insizevar}
\setlength{\insizevar}{1.2em}

\newlength{\nisize}
\setlength{\nisize}{0.7em}

\newlength{\nisizevar}
\setlength{\nisizevar}{1.2em}

\newlength{\subsetsize}
\setlength{\subsetsize}{0.8em}

\newlength{\supsetsize}
\setlength{\supsetsize}{0.8em}

\newlength{\idtfsize}
\setlength{\idtfsize}{1.1em}

\newlength{\arrowsize}
\setlength{\arrowsize}{1em}

\newlength{\arrowsizevar}
\setlength{\arrowsizevar}{1.7em}

\newlength{\bulletsize}
\setlength{\bulletsize}{0.5em}

\newlength{\bulletbracketsize}
\setlength{\bulletbracketsize}{1.15em}

\newlength{\bracketsize}
\setlength{\bracketsize}{0.4em}

\newlength{\squaresize}
\setlength{\squaresize}{0.7em}

\newlength{\doublesquaresize}
\setlength{\doublesquaresize}{1.4em}

\newlength{\commentsize}
\setlength{\commentsize}{1em}

\newlength{\eqsize}
\setlength{\eqsize}{0.8em}

\newlength{\substructsize}
\setlength{\substructsize}{1.7em}

\newlength{\toclineskip}
\setlength{\toclineskip}{\baselineskip}

\newlength\afterparlength
\setlength{\afterparlength}{-2em}

\newlength\afterseglength
\setlength{\afterseglength}{-1em}

\newcounter{hind}
% seg counter is used to set two bigskips after the first segment in section
% Maybe we should remove it
\newcounter{seg}

% Create line with dots
\newcommand{\filldots}{\xleaders\hbox{*}\hfill}

\newcommand{\scnsupergroupsign}{\textasciicircum}
\newcommand{\scnrolesign}{\,$^\prime$}

\newcommand{\calctab}{\dimexpr (\tabsize)*\value{hind} \relax}
\newcommand{\settab}{\hspace{\calctab}}
\newcommand{\sethind}{\setlength{\hangindent}{\calctab} }
\newcommand{\calcdiff}[1]{\dimexpr \tabsize-#1  \relax}
\newcommand{\makediff}[1]{\hspace{\calcdiff{#1}}}

\RequirePackage{microtype}
\newcommand{\textspaced}[1]{\textls[200]{#1}}

\newcommand{\scnaddhind}[1]{
\addtocounter{hind}{#1}}

\newcommand{\scnfileshort}[1]{
{\normalfont [#1]}
}

\RequirePackage{amsmath,bm}

\newcommand{\scnstartstruct}{\settab$\pmb{=\{}$\\}

\newcommand{\scnstartsubstruct}{\settab$\pmb{\supset=\{}$\\}

\newcommand{\scnstartset}{\settab$\pmb{\{}$}

\newcommand{\scnstartsetlocal}{$\pmb{\{}$}

\newcommand{\scnstructinclusion}{\settab$\pmb{\supset=}$\\}

\newcommand{\scnendstruct}{\settab$\pmb{\}}$}

\newcommand{\scnendstructlocal}{$\pmb{\}}$}

\newcommand{\scnstartfile}{\settab\textbf{=}\\
\settab\textbf{[}\\}

\newcommand{\scnendfile}{\settab\textbf{]}}

%DEFINES END

\RequirePackage{tocloft}
\makeatletter
\renewcommand{\@cftmaketoctitle}{}
\makeatother
\renewcommand{\cftchapfont}{\bfseries}
\renewcommand{\cftsecfont}{\bfseries}
\renewcommand{\cftsubsecfont}{\bfseries}
\renewcommand{\cftpartleader}{\cftdotfill{\cftdotsep}}
\renewcommand{\cftchapleader}{\cftdotfill{\cftdotsep}}
\renewcommand{\cftsecleader}{\cftdotfill{\cftdotsep}}
\renewcommand{\cftsubsecleader}{\cftdotfill{\cftdotsep}}
\renewcommand{\cftsubsubsecleader}{\cftdotfill{\cftdotsep}}

\makeatletter
\renewcommand{\cftchappresnum}{\begin{lrbox}{\@tempboxa}}
\renewcommand{\cftchapaftersnum}{\end{lrbox}}
\cftsetindents{chapter}{0pt}{0pt}
\renewcommand{\cftsecpresnum}{\begin{lrbox}{\@tempboxa}}
\renewcommand{\cftsecaftersnum}{\end{lrbox}}
\cftsetindents{section}{\tabsize}{0pt}
\renewcommand{\cftsubsecpresnum}{\begin{lrbox}{\@tempboxa}}
\renewcommand{\cftsubsecaftersnum}{\end{lrbox}}
\cftsetindents{subsection}{\tabsize+\tabsize}{0pt}
\renewcommand{\cftsubsubsecpresnum}{\begin{lrbox}{\@tempboxa}}
\renewcommand{\cftsubsubsecaftersnum}{\end{lrbox}}
\cftsetindents{subsubsection}{\tabsize+\tabsize+\tabsize}{0pt}
\renewcommand{\cftparapresnum}{\begin{lrbox}{\@tempboxa}}
\renewcommand{\cftparaaftersnum}{\end{lrbox}}
\cftsetindents{paragraph}{\tabsize+\tabsize+\tabsize+\tabsize}{0pt}
\renewcommand{\cftsubparapresnum}{\begin{lrbox}{\@tempboxa}}
\renewcommand{\cftsubparaaftersnum}{\end{lrbox}}
\cftsetindents{subparagraph}{\tabsize+\tabsize+\tabsize+\tabsize+\tabsize}{0pt}
\renewcommand\cftchapafterpnum{\vspace{\toclineskip}}
\renewcommand\cftsecafterpnum{\vspace{\toclineskip}}
\renewcommand\cftsubsecafterpnum{\vspace{\toclineskip}}
\renewcommand\cftsubsubsecafterpnum{\vspace{\toclineskip}}
\renewcommand\cftparaafterpnum{\vspace{\toclineskip}}
\renewcommand\cftsubparaafterpnum{\vspace{\toclineskip}}
\makeatother

%SCN START


\newif\iffilemode
\filemodefalse

\makeatletter

\newenvironment{SCn}{
\setcounter{hind}{0} 
\begin{flushleft}
}
{
\end{flushleft}
}

\newcommand{\scnaddlevel}[1]{
\addtocounter{hind}{#1}
}

\newcommand{\scnresetlevel}{
\setcounter{hind}{0}
}

\newcommand{\scnheader}[1]{\scnresetlevel\sethind~\vspace{\parskip}\\
\textit{\textbf{#1}}\\}

\newcommand{\scnstructheader}[1]{\scnresetlevel\sethind~\vspace{\parskip}\\
\textit{\textbf{\textspaced{#1}}}\\}

\newcommand{\scnheaderlocal}[1]{\settab\textit{\textbf{#1}}\\}

\newcommand{\scnstructheaderlocal}[1]{\settab\textit{\textbf{\textspaced{#1}}}\\}

\newcommand{\scnstructidtf}[1]{\textit{\textspaced{#1}}}

\newcommand{\scnkeyword}[1]{\textit{\textbf{#1}}}

\newcommand{\scnsectionheader}[1]{\setcounter{seg}{0} \textspaced{\scnheader{\large #1}}}

\makeatletter
\newcommand{\scnsegmentcaption}{\normalfont \bfseries /*~\textspaced{Сегмент}~\filldots/\hspace{\textwidth}\normalfont\vspace{\afterseglength}}
\makeatother

\newcommand{\scnsegmentheader}[1]{
\addtocounter{seg}{1}
\ifnum\value{seg}>1
\bigskip
\bigskip
\else
\bigskip
\fi
\scnsegmentcaption
\textspaced{\scnheader{#1}}
}

\newcommand\scnlistitem[1]{
\sethind
\settab{$\bullet$\makediff{\bulletsize}\itshape#1} \\
}

\NewDocumentCommand\scnlist{>{\SplitList{;}}m}
   {\ProcessList{#1}{\scnlistitem}}

\newcommand\scnrellistitem[1]{{\textit{#1}*{\normalfont:~}}}

\NewDocumentCommand\scnrellist{>{\SplitList{;}}m}
   {\ProcessList{#1}{\scnrellistitem}}

\newcommand\scnrolerellistitem[1]{{\textit{#1}\scnrolesign{\normalfont:~}}}

\NewDocumentCommand\scnrolerellist{>{\SplitList{;}}m}
   {\ProcessList{#1}{\scnrolerellistitem}}
 
\newcommand\scnvarrellistitem[1]{{\textit{#1}*{\normalfont::~}}}  

\NewDocumentCommand\scnvarrellist{>{\SplitList{;}}m}
   {\ProcessList{#1}{\scnvarrellistitem}}
   
\newcommand\scnvarrolerellistitem[1]{{\textit{#1}\scnrolesign{\normalfont::~}}}

\NewDocumentCommand\scnvarrolerellist{>{\SplitList{;}}m}
   {\ProcessList{#1}{\scnvarrolerellistitem}}

\RequirePackage{calc}
\RequirePackage{changepage}
\RequirePackage{ragged2e}

\newcommand\scnfilelistitem[1]{
\begin{adjustwidth}{\calctab+\tabsize+\bracketsize}{0em}
\justify
\setlength{\parskip}{0.5em}
\hspace{-\tabsize}\hspace{-\bracketsize}
\normalfont$\bullet$\makediff{\bracketsize}[#1]
\setlength{\parskip}{\baselineskip}
\end{adjustwidth}
}

\NewDocumentCommand\scnfilelist{>{\SplitList{;}}m}
   {\ProcessList{#1}{\scnfilelistitem}}

\newcommand\scnlistitembrackets[1]{
\sethind
\settab\hspace{\bulletbracketsize}
{$\bullet$\makediff{\bulletbracketsize}\itshape#1}\\
}

\NewDocumentCommand\scnlistbrackets{>{\SplitList{;}}m}
   {\ProcessList{#1}{\scnlistitembrackets}}

\newcommand\scnfilelistitembrackets[1]{
\scnaddlevel{1}
\begin{adjustwidth}{\calctab+\tabsize+\bracketsize}{0em}
\justify
\setlength{\parskip}{0.5em}
\hspace{-\tabsize}\hspace{0.2em}
\normalfont$\bullet$\makediff{\bulletbracketsize}[#1]
\setlength{\parskip}{\baselineskip}
\end{adjustwidth}
\scnaddlevel{-1}
}

\NewDocumentCommand\scnfilelistbrackets{>{\SplitList{;}}m}
   {\ProcessList{#1}{\scnfilelistitembrackets}}

\newcommand{\scnfilelong}[1]{
\begin{adjustwidth}{\calctab+0.4em}{0em}
\justify
\setlength{\parindent}{0em}
\setlength{\itemindent}{0em}
\setlength{\parskip}{0.5em}
\hspace{-0.4em}\normalfont \textbf{[}#1\textbf{]}
\end{adjustwidth}
}

\newcommand\scnfileitem[1]{\scnaddlevel{1}\scnfilelong{#1}\scnaddlevel{-1}}

\RequirePackage{tabularx}
\RequirePackage{graphicx}
\RequirePackage{colortbl}

\newcommand{\scnfilescg}[1]{
\begin{adjustwidth}{\calctab}{0em}
\setlength{\parindent}{0em}
\setlength{\itemindent}{0em}
\setlength{\parskip}{0.5em}
\normalfont \textbf{[}
\cellcolor{white}
\begin{center}
\includegraphics[width=(\textwidth-\calctab)]{#1}
\end{center}
\textbf{]}
\end{adjustwidth}
}

\newcommand\scgfileitem[1]{\scnaddlevel{1}\scnfilescg{#1}\scnaddlevel{-1}}

\newcommand{\scnrelfrom}[2]{
\settab$\bm{\Rightarrow}$\hspace{\tabsize-\arrowsize}\scnrellist{#1}\\
\scnaddlevel{1}
\sethind
\settab{\itshape#2}
\scnaddlevel{-1}
}

\newcommand{\scnrelsuperset}[2]{
\settab$\bm{\supset}$\hspace{\tabsize-\supsetsize}\scnrellist{#1}\\
\scnaddlevel{1}
\sethind
\settab{\itshape#2}
\scnaddlevel{-1}
}

\newcommand{\scnvarrelfrom}[2]{
	\settab\textunderscore$\bm{\Rightarrow}$\makediff{\arrowsizevar}\scnvarrellist{#1}\\
	\scnaddlevel{1}
	\sethind
	\settab{\itshape #2}
	\scnaddlevel{-1}
}

\newcommand{\scnrelto}[2]{
\settab$\bm{\Leftarrow}$\makediff{\arrowsize}\scnrellist{#1}\\
\scnaddlevel{1}
\sethind 
\settab{\itshape #2}
\scnaddlevel{-1}
}

\newcommand{\scnvarrelto}[2]{
\settab\textunderscore$\bm{\Leftarrow}$\makediff{\arrowsizevar}\scnvarrellist{#1}\\
\scnaddlevel{1}
\sethind 
\settab{\itshape #2}
\scnaddlevel{-1}
}

\newcommand{\scnrelfromlist}[2]{
\settab$\bm{\Rightarrow}$\makediff{\arrowsize}\scnrellist{#1}\\
\scnaddlevel{1}
\sethind 

\iffilemode
\scnfilelist{#2}
\else
\scnlist{#2}
\fi

\scnaddlevel{-1}
}

\newcommand{\scnreltolist}[2]{
\settab$\bm{\Leftarrow}$\makediff{\arrowsize}\scnrellist{#1}\\
\scnaddlevel{1}
\sethind 

\iffilemode
\scnfilelist{#2}
\else
\scnlist{#2}
\fi

\scnaddlevel{-1}
}

\newcommand{\scnrelboth}[2]{
\settab$\bm{\Leftrightarrow}$\makediff{\arrowsize}\scnrellist{#1}\\
\scnaddlevel{1}
\sethind 
\settab{\itshape #2} \\
\scnaddlevel{-1}
}

\newcommand{\scnrelbothlist}[2]{
\settab$\bm{\Leftrightarrow}$\makediff{\arrowsize}\scnrellist{#1}\\
\scnaddlevel{1}
\sethind 

\iffilemode
\scnfilelist{#2}
\else
\scnlist{#2}
\fi

\scnaddlevel{-1}
}

\newcommand{\scnrelfromcommonset}[4]{
\settab$\bm{\Rightarrow}$\makediff{\arrowsize}\scnrellist{#3}\\
\scnaddlevel{1}

\settab#1\\
\iffilemode
\vspace{-1.55\baselineskip}
\scnfilelistbrackets{#4}
\else
\vspace{-1\baselineskip}
\scnlistbrackets{#4}
\fi
\settab#2\\

\scnaddlevel{-1}
}

\newcommand{\scnrelfromset}[2]{\scnrelfromcommonset{$\pmb{\{}$}{$\pmb{\}}$}{#1}{#2}}

\newcommand{\scnrelfromvector}[2]{\scnrelfromcommonset{$\pmb{\langle}$}{$\pmb{\rangle}$}{#1}{#2}}

\newcommand{\scnreltocommonset}[4]{
\settab$\bm{\Leftarrow}$\makediff{\arrowsize}\scnrellist{#3}\\
\scnaddlevel{1}
\sethind 

\settab#1\\
\iffilemode
\vspace{-1.55\baselineskip}
\scnfilelistbrackets{#4}
\else
\vspace{-1\baselineskip}
\scnlistbrackets{#4}
\fi
\settab#2\\

\scnaddlevel{-1}
}

\newcommand{\scnreltoset}[2]{\scnreltocommonset{$\pmb{\{}$}{$\pmb{\}}$}{#1}{#2}}

\newcommand{\scnreltovector}[2]{\scnreltocommonset{$\pmb{\langle}$}{$\pmb{\rangle}$}{#1}{#2}}

\newcommand{\scneq}[1]{
\sethind 
\settab$\bm{=}$\makediff{\eqsize}{\itshape #1}\\
}

\newcommand{\scneqfile}[1]{
\settab$\bm{=}$\\ 
\scnfilelong{#1}
}

\newcommand{\scnfileimage}[1]{
\begin{adjustwidth}{\calctab}{0em}
\setlength{\parindent}{0em}
\setlength{\itemindent}{0em}
\setlength{\parskip}{0.5em}
\vspace{-1.5em}
\normalfont \textbf{[}
\setlength\arrayrulewidth{1pt}
\hspace{0.1em}
\begin{tabularx}{\textwidth-\calctab}{X}
\cellcolor{white}
\begin{center}
\vspace{-1.3\baselineskip}#1
\vspace{-0.7\baselineskip}
\end{center}
\end{tabularx}
\textbf{]}
\end{adjustwidth}
}

\newcommand{\scneqimage}[1]{
\settab$\bm{=}$\\ 
\vspace{0.5\baselineskip}
\scnfileimage{#1}
}

\RequirePackage[table]{xcolor}

\newcommand{\scnfiletable}[1]{
\begin{adjustwidth}{\calctab}{0em}
\setlength{\parindent}{0em}
\setlength{\itemindent}{0em}
\setlength{\parskip}{0.5em}
\vspace{-1.5em}
\normalfont \textbf{[}
\rowcolors{1}{white}{white}
#1
\textbf{]}
\end{adjustwidth}
}

\newcommand{\scneqtable}[1]{
\settab$\bm{=}$\\ 
\vspace{0.5\baselineskip}
\scnfiletable{#1}
}

\newcommand{\scneqscg}[1]{
\settab$\bm{=}$\\ 
\vspace{0.5\baselineskip}
\scnfilescg{#1}
}

\newcommand{\scnfileclass}[1]{
{\normalfont\hspace{-0.3em}![~#1~]!}
}

\newcommand{\scneqfileclass}[1]{
\settab$\bm{=}$\makediff{\eqsize}\scnfileclass{#1}\\
}

\newcommand{\scneqtocommonset}[3]{
\settab$\bm{=}$\makediff{\eqsize}#1\\
\scnaddlevel{1}
\sethind 

\iffilemode
\vspace{-1.55\baselineskip}
\scnfilelistbrackets{#3}
\else
\vspace{-1\baselineskip}
\scnlistbrackets{#3}
\fi
\settab#2\\

\scnaddlevel{-1}
}

\newcommand{\scneqtoset}[1]{\scneqtocommonset{$\pmb{\{}$}{$\pmb{\}}$}{#1}}

\newcommand{\scneqtovector}[1]{\scneqtocommonset{$\pmb{\langle}$}{$\pmb{\rangle}$}{#1}}

\newcommand{\scnhassubstruct}[1]{
\settab$\bm{\supset=}$\makediff{\substructsize}$\pmb{\{}$\\
\scnaddlevel{1}
\sethind 
\iffilemode
\vspace{-1.55\baselineskip}
\scnfilelistbrackets{#1}
\else
\vspace{-1\baselineskip}
\scnlistbrackets{#1}
\fi
\settab$\pmb{\}}$\\
\scnaddlevel{-1}
}

\newcommand{\scnsubset}[1]{
\sethind 
\settab$\bm{\subset}$\makediff{\subsetsize}{\itshape #1}\\
}

\newcommand{\scnnotsubset}[1]{
\sethind 
\settab$\bm{\not\subset}$\makediff{\subsetsize}{\itshape #1}\\
}

\newcommand{\scnsuperset}[1]{
\sethind 
\settab$\bm{\supset}$\makediff{\supsetsize}{\itshape #1}\\
}

\newcommand{\scniselement}[1]{
\sethind
\settab$\bm{\in}$\hspace{\calcdiff{\insize}}{\itshape #1}\\
}

\newcommand{\scnisvarelement}[1]{
	\sethind
	\settab\textunderscore$\bm{\in}$\makediff{\insizevar}{\itshape #1}\\
}

\newcommand{\scnmakecommonsetlocal}[3]{
\scnaddlevel{1}
\settab
\hspace{-\bracketsize}#1\\
\vspace{-1\baselineskip}
\scnlistbrackets{#3}
\settab#2\\
\scnaddlevel{-1}
}

\newcommand{\scnmakesetlocal}[1]{\scnmakecommonsetlocal{$\pmb{\{}$}{$\pmb{\}}$}{#1}}

\newcommand{\scnmakevectorlocal}[1]{\scnmakecommonsetlocal{$\pmb{\langle}$}{$\pmb{\rangle}$}{#1}}

\newcommand{\scnmakeset}[1]{
\settab$\pmb{\{}$\\
\sethind 
\vspace{-1\baselineskip}
\scnlistbrackets{#1}
\settab$\pmb{\}}$\\
}

\newcommand{\scnhaselementset}[1]{
\settab$\bm{\ni}$\makediff{5em}\scnmakesetlocal{#1}
}

\newcommand{\scnhaselementvector}[1]{
\settab$\bm{\ni}$\makediff{5em}\scnmakevectorlocal{#1}
}

\newcommand{\scnhaselement}[1]{
\sethind 
\settab$\bm{\ni}$\makediff{\nisize}{\itshape #1}\\
}

\newcommand{\scnhasvarelement}[1]{
\sethind 
\settab\textunderscore$\bm{\ni}$\makediff{\nisizevar}{\itshape #1}\\
}

\newcommand{\scnhaselements}[1]{
\sethind 
\settab$\bm{\ni}$\makediff{\nisize}#1\\
}

\newcommand{\scnsubdividing}[1]{\scnrelfromset{разбиение}{#1}}

\newcommand{\scnhaselementrole}[2]{
\settab$\bm{\ni}$\makediff{\nisize}\scnrolerellist{#1}\\
\scnaddlevel{1}
\sethind 
\settab{\itshape #2}\\
\scnaddlevel{-1}
}

\newcommand{\scnhasvarelementrole}[2]{
	\settab\textunderscore$\bm{\ni}$\makediff{\nisizevar}\scnvarrolerellist{#1}\\
    \scnaddlevel{1}
	\sethind 
	\settab{\itshape #2}\\
	\scnaddlevel{-1}
}

\newcommand{\scnhaselementlist}[2]{
\settab$\bm{\ni}$\makediff{\nisize}\scnrolerellist{#1}\\
\scnaddlevel{1}
\sethind 
\scnlist{#2}
\scnaddlevel{-1}
}

\newcommand{\scniselementrole}[2]{
\settab$\bm{\in}$\makediff{\insize}\scnrolerellist{#1}\\
\scnaddlevel{1}
\sethind 
\settab{\itshape #2}\\
\scnaddlevel{-1}
}

\newcommand{\scniselementlist}[2]{
\settab$\bm{\in}$\makediff{\nisize}\scnrolerellist{#1}\\
\scnaddlevel{1}
\sethind 
\scnlist{#2}
\scnaddlevel{-1}
}

\newcommand{\scnrole}[1]{{\itshape #1\scnrolesign}:}

\newcommand{\scnset}[1]{$\pmb{\{}$#1$\pmb{\}}$}
\newcommand{\scnvector}[1]{$\pmb{\langle}$#1$\pmb{\rangle}$}

\RequirePackage{mathtools}

\newcommand{\scnidtf}[1]{
\begin{adjustwidth}{\calctab+\tabsize+\bracketsize}{0em}
\justify
\setlength{\parindent}{0em}
\setlength{\itemindent}{0em}
\setlength{\parskip}{0.5em}
\vspace{-0.4\baselineskip}
\hspace{-\tabsize}\hspace{-\bracketsize}\normalfont$\bm{\coloneqq}$\makediff{\idtfsize}[#1]
\end{adjustwidth}
}

\newcommand{\scnidtftext}[2]{
\settab$\bm{\coloneqq}$\hspace{\calcdiff{\idtfsize}}\scnrellist{#1}\\
\settab\scnfilelong{#2}
}

\newcommand{\scnidtfdef}[1]{\scnidtftext{определение}{#1}}

\newcommand{\scnidtfexp}[1]{\scnidtftext{пояснение}{#1}}

\newcommand{\scnexternalfile}[1]{
\begin{adjustwidth}{\calctab+0.4em}{0em}
\justify
\setlength{\parindent}{0em}
\setlength{\itemindent}{0em}
\setlength{\parskip}{0.5em}
\normalfont#1
\end{adjustwidth}
}

\newcommand{\scnfilescn}[1]{
	\begin{adjustwidth}{\calctab}{0em}
		\setlength{\parindent}{0em}
		\setlength{\itemindent}{0em}
		\setlength{\parskip}{0.5em}
		\normalfont \textbf{[}
		#1
		\textbf{]}
	\end{adjustwidth}
}

\newcommand{\scnfilelongbreaks}[1]{\scnfilelong{\\#1\\}}

\newcommand{\scntext}[2]{
\scnrelfrom{#1}{\scnfilelong{#2}}
}

\newcommand{\scneqhierstruct}{\settab$\pmb{=}$\\ $\pmb{\langle|}$}

\newcommand{\scnstarthierstruct}{\settab$\pmb{\langle|}$}

\newcommand{\scnendhierstruct}{\settab$\pmb{|\rangle}$}

\newcommand{\scncomment}[1]{
\scntext{комментарий}{#1}
}

\newcommand{\scnexplanation}[1]{
\scntext{пояснение}{#1}
}

\newcommand{\scnnote}[1]{
\scntext{примечание}{#1}
}

\newcommand{\scndefinition}[1]{
\scntext{определение}{#1}
}

\newcommand{\scnevolution}[1]{
\scntext{эволюция}{#1}
}

\newcommand{\scnproblems}[1]{
\scntext{проблемы}{#1}
}

\newcommand{\scnevolutiondirections}[1]{
\scntext{направления эволюции}{#1}
}

\newcommand{\scnevolutionproblems}[1]{
\scntext{проблемы развития}{#1}
}

\newcommand{\scnmodernstate}[1]{
\scntext{современное состояние}{#1}
}

\newcommand{\scnsolutionapproach}[1]{
\scntext{предлагаемый подход к решению}{#1}
}

\newcommand{\scnadvantages}[1]{
\scntext{достоинства}{#1}
}

\newcommand{\scnprinciples}[1]{
\scntext{принципы}{#1}
}

\newcommand{\scnspheresapplication}[1]{
\scntext{сферы применения}{#1}
}

\newcommand{\scnseminclusion}[1]{
\scntext{семантическое включение}{#1}
}

\newcommand{\scneditor}[1]{
\scnrelfrom{редактор}{#1}
}

\newcommand{\scneditors}[1]{
\scnrelfromlist{редактор}{#1}
}

%Subject domains
\newcommand{\scnsdmainclass}[1]{
\scnhaselementlist{максимальный класс объектов исследования}{#1}
}

\newcommand{\scnsdmainclasssingle}[1]{
\scnhaselementrole{максимальный класс объектов исследования}{#1}
}

\newcommand{\scnsdclass}[1]{
\scnhaselementlist{класс объектов исследования}{#1}
}

\newcommand{\scnsdrelation}[1]{
\scnhaselementlist{исследуемое отношение}{#1}
}

%Developer info

\newcommand{\timestamp}{\vspace{0.5em}\scnauthorcomment{\textbf{\large Версия от \today~ \currenttime}}}

\newcommand{\addedstart}{\reversemarginpar\marginpar{\hspace{3em}НОВОЕ~[}}

\newcommand{\addedend}{\reversemarginpar\marginpar{\hspace{3em}]~НОВОЕ}}

\newcommand{\editedstart}{\reversemarginpar\marginpar{\hspace{3em}ИЗМЕНЕНО~[}}

\newcommand{\editedend}{\reversemarginpar\marginpar{\hspace{3em}]~ИЗМЕНЕНО}}

\newcommand{\scnbigspace}{~~}


\newcommand{\scnsourcecomment}[1]{{\normalfont \normalsize \textbf{/*~}#1\textbf{{}~*/}}}

\newcommand{\scnsourcecommentpar}[1]{
\begin{adjustwidth}{\calctab+1em}{0em}
\justify
\setlength{\parindent}{0em}
\setlength{\itemindent}{0em}
\hspace{-1em}\normalfont /*~#1{}~*/
\end{adjustwidth}
}

\newcommand{\scninlinesourcecommentpar}[1]{
\begin{adjustwidth}{\calctab+1em+\tabsize}{0em}
\justify
\setlength{\parindent}{0em}
\setlength{\itemindent}{0em}
\vspace{-0.9\baselineskip}
\hspace{-1em}\normalfont /*~#1{}~*/
\end{adjustwidth}
}

\makeatletter
\newcommand{\scnendcurrentsectioncomment}{
\scninlinesourcecommentpar{Завершили раздел ``\textit{\@currentlabelname}''}
}
\makeatother

\newcommand{\scnendsegmentcomment}[1]{
	\scninlinesourcecommentpar{Завершили Сегмент ``\textit{#1}''}
}

\newcommand{\scnendfragmentcomment}{\\
{\bfseries \normalsize /*\filldots/\hspace{0.5\textwidth}}
}

\newcommand{\scnauthorcomment}[1]{\begin{flushleft}
/*/*#1*/*/\end{flushleft}}

\RequirePackage{nameref}
\RequirePackage{mdframed}
\newenvironment{FileFrame}{
\begin{mdframed}[linewidth=0.5mm,roundcorner=0pt]
}
{
\end{mdframed}
}

\newenvironment{ContourFrame}{
\begin{mdframed}[linewidth=0.5mm,roundcorner=20pt]
}
{
\end{mdframed}
}

%Sections START

\RequirePackage[pagestyles]{titlesec}

\titleformat{\chapter}[display]{\normalfont\bfseries}{}{0pt}{\normalsize}

\titleformat{\section}[display]{\normalfont\bfseries}{}{0pt}{\normalsize}

\titleformat{\subsection}[display]{\normalfont\bfseries}{}{0pt}{\normalsize}

\titleformat{\subsubsection}[display]{\normalfont\bfseries}{}{0pt}{\normalsize}

\titleformat{\paragraph}[display]{\normalfont\bfseries}{}{0pt}{\normalsize}

\titlespacing*{\chapter}
{0em}{0em}{0em}
\titlespacing*{\section}
{0em}{0em}{0em}
\titlespacing*{\subsection}
{0em}{0em}{0em}
\titlespacing*{\subsubsection}
{0em}{0em}{0em}
\titlespacing*{\paragraph}
{0em}{0em}{0em}

\newcommand{\scsuperchapter}{{\normalfont\bfseries\large/*\filldots/}\vspace{0.5\afterparlength}}

\newcommand{\scsectionfamily}[2][]{\clearpage\chapter[\textit{#2}]{/*~\textspaced{\large Семейство разделов}~\filldots/\vspace{\afterparlength}}
	\ifx&#1&
	\else
	\addtocontents{toc}{\vspace{\dimexpr -\toclineskip-0.4\baselineskip \relax}\parbox{\textwidth}{\begin{SCn}\protect#1\end{SCn}}
		\vspace{\toclineskip}}
	\fi}

\newcommand{\scchapter}[2][]{\clearpage\chapter[\textit{#2}]{/*~\textspaced{\large Раздел}~\filldots/\vspace{\afterparlength}}
\ifx&#1&
\else
\addtocontents{toc}{\vspace{\dimexpr -\toclineskip-0.4\baselineskip \relax}\parbox{\textwidth}{\begin{SCn}\protect#1\end{SCn}}
\vspace{\toclineskip}}
\fi}

\newcommand{\scsection}[2][]{\clearpage
\section[\textit{#2}]{/*~\textspaced{\large Раздел}~\filldots/\vspace{\afterparlength}}
\ifx&#1&
\else
\addtocontents{toc}{\vspace{\dimexpr -\toclineskip+0.1\baselineskip \relax}\parbox{\textwidth}{\begin{adjustwidth}{\tabsize}{0em}\begin{SCn}\protect#1\end{SCn}\end{adjustwidth}}
\vspace{\toclineskip}}
\fi}

\newcommand{\scseparatedfragment}[2][]{\clearpage\chapter[\textit{#2}]{/*\filldots/\vspace{\afterparlength}}
\ifx&#1&
\else
\addtocontents{toc}{\vspace{\dimexpr -\toclineskip-0.4\baselineskip \relax}\parbox{\textwidth}{\begin{SCn}\protect#1\end{SCn}}
\vspace{\toclineskip}}
\fi}

\newcommand\scsubsection[2][]{\clearpage
\subsection[\textit{#2}]{/*~\textspaced{\large Section}~\filldots/\vspace{\afterparlength}}
\ifx&#1&
\else
\addtocontents{toc}{\vspace{\dimexpr -\toclineskip+0.1\baselineskip \relax}\parbox{\textwidth}{\begin{adjustwidth}{\tabsize+\tabsize}{0em}\begin{SCn}\protect#1\end{SCn}\end{adjustwidth}}
\vspace{\toclineskip}}
\fi}

\newcommand{\scsubsubsection}[2][]{\clearpage
\subsubsection[\textit{#2}]{/*~\textspaced{\large Раздел}~\filldots/\vspace{\afterparlength}}
\ifx&#1&
\else
\addtocontents{toc}{\vspace{\dimexpr -\toclineskip+0.1\baselineskip \relax}\parbox{\textwidth}{\begin{adjustwidth}{\tabsize+\tabsize+\tabsize}{0em}\begin{SCn}\protect#1\end{SCn}\end{adjustwidth}}
\vspace{\toclineskip}}
\fi}

\newcommand{\scparagraph}[2][]{\clearpage\paragraph[\textit{#2}]{/*~\textspaced{\large Раздел}~\filldots/\vspace{\afterparlength}}
\ifx&#1&
\else
\addtocontents{toc}{\vspace{\dimexpr -\toclineskip+0.1\baselineskip \relax}\parbox{\textwidth}{\begin{adjustwidth}{\tabsize+\tabsize+\tabsize+\tabsize}{0em}\begin{SCn}\protect#1\end{SCn}\end{adjustwidth}}
\vspace{\toclineskip}}
\fi}

\makeatletter
\newcommand*{\currentname}{\@currentlabelname}
\makeatother

\makeatletter
\newcommand*{\currentnumber}{\@currentlabel}
\makeatother

%Sections END

% Itemize START

\RequirePackage{enumitem}
\RequirePackage{amssymb}

\newenvironment{scnitemize}{
\begin{itemize}[leftmargin=\leftmargin-1em+\bracketsize,itemsep=-0.25em,before=\vspace{-0.8em},after=\vspace{-0.5em}]
\renewcommand{\labelitemi}{\scriptsize$\square$}
\renewcommand{\labelitemii}{\scriptsize$\square~\square$}
\renewcommand{\labelitemiii}{\scriptsize$\square~\square~\square$} 
}
{
\end{itemize}
}

\newenvironment{scnitemizeii}{
\begin{itemize}[leftmargin=\leftmargin-1em+\bracketsize+\squaresize,itemsep=-0.25em,before=\vspace{-0.3em},after=\vspace{0em}]
\renewcommand{\labelitemi}{\scriptsize$\square~\square$} 
}
{
\end{itemize}
}

\newenvironment{scnitemizeiii}{
\begin{itemize}[leftmargin=\leftmargin-1em+\bracketsize+\doublesquaresize,itemsep=-0.25em,before=\vspace{-0.3em},after=\vspace{0em}]

\renewcommand{\labelitemi}{\scriptsize$\square~\square$} 
}
{
\end{itemize}
}

\newenvironment{scnenumerate}{
\begin{enumerate}[leftmargin=\leftmargin-1em+\bracketsize,itemsep=-0.25em,before=\vspace{-0.8em},after=\vspace{-0.5em}]
}
{
\end{enumerate}
}

% Itemize END

% Background START

\RequirePackage[pages=all]{background}
\RequirePackage{tikz}
\usetikzlibrary{calc} 
\RequirePackage{layout}

\newcommand{\drawvlines}{
\begin{tikzpicture}[remember picture,overlay]

\coordinate (NW) at ([
            xshift=0.36in,
            yshift=-1.1in-2\voffset-\topmargin-\headheight-\headsep,
        ]current page.north west);
        
\coordinate (SW) at ([
            xshift=0.36in,
            yshift=-1.1in-2\voffset-\topmargin-\headheight-\headsep-\textheight,
        ]current page.north west);

\foreach \i in {1,2,...,18}{
\draw[black!50] ($(NW)+(\i*\tabsize,0)$) -- ($(SW)+(\i*\tabsize,0)$);}

\end{tikzpicture}
}

\newcommand\DeactivateBG{\backgroundsetup{contents={}}}
\newcommand\ActivateBG{\backgroundsetup{contents={\drawvlines}}}

\backgroundsetup{
scale=1,
color=black,
opacity=1.0,
angle=0
}

% Background END

% SCs 

\newcommand{\scsrelto}[2]{
$\bm{\Leftarrow}$~{\itshape #1*}{\normalfont :}~{\itshape #2}}

\newcommand{\scsabrreviation}[2]{\scnfileclass{#1}\scsrelto{является сокращением}{\scnfileclass{#2}}
}

% SCs END


\newcommand{\scnqq}[1]{
    "#1"{}
}

\newcommand{\scnqqi}[1]{
    ``#1''
}

\usepackage{expl3}
\usepackage{etoolbox}
\usepackage[
style=ieee,
citestyle=authoryear,
maxnames=3
]{biblatex}


\ExplSyntaxOn

\clist_new:N \scncitenames
\prop_new:N \scncitelist

\NewDocumentCommand \addcite {m m} 
{
    \prop_if_in:NnTF \scncitelist {#1}{}{
        \prop_gput:NnV \scncitelist {#1}{#2}
        \clist_gput_right:Nn \scncitenames {#1}
    }
}
\NewDocumentCommand \printscnbiblio {} 
{
    \clist_sort:Nn \scncitenames
    {
        \ifnumcomp{\pdfstrcmp{##1}{##2}}{>}{0}
        { \sort_return_swapped: }
        { \sort_return_same: }
    }
    \clist_map_inline:Nn \scncitenames {\prop_item:Nn \scncitelist {##1}}
}
\ExplSyntaxOff

\newcommand{\scncite}[1]{
\scncitecommon{#1}{\cite{#1}}
}

\newcommand{\scncitecommon}[2]{
\hspace{-0.6em}\textit{#2}\hspace{-0.8em}
\addcite{#2}{\printscncite{#1}{#2}}
}

\newcommand{\printscncite}[2]{
\scnheader{#2}
\scntext{библиографическая ссылка}{\fullcite{#1}}
}

\newcommand{\scnciteannotation}[1]{
	\scntext{аннотация}{\citefield{#1}{annotation}}
}

\endinput
