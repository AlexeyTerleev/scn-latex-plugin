\NeedsTeXFormat{LaTeX2e}[2021-06-01]
\ProvidesPackage{scn-latex-plugin/scn}
  [2022/07/26 v0.1.0 LaTeX package for SCn-code support]

\RequirePackage[utf8]{inputenc}
\RequirePackage[T2A]{fontenc}
\RequirePackage[russian]{babel}
%DEFINES START

\newcommand\tabsize{3em}

\newlength{\insize}
\setlength{\insize}{0.6em}

\newlength{\insizevar}
\setlength{\insizevar}{1.2em}

\newlength{\subsetsize}
\setlength{\subsetsize}{0.9em}

\newlength{\coloneqsize}
\setlength{\coloneqsize}{1.1em}

\newlength{\arrowsize}
\setlength{\arrowsize}{1.1em}

\newlength{\arrowsizevar}
\setlength{\arrowsizevar}{1.7em}

\newlength{\bulletsize}
\setlength{\bulletsize}{0.5em}

\newlength{\bulletbracketsize}
\setlength{\bulletbracketsize}{1em}

\newlength{\bracketsize}
\setlength{\bracketsize}{0.7em}

\newlength{\squaresize}
\setlength{\squaresize}{0.7em}

\newlength{\doublesquaresize}
\setlength{\doublesquaresize}{1.4em}

\newlength{\eqsize}
\setlength{\eqsize}{0.9em}

\newlength{\substructsize}
\setlength{\substructsize}{1.7em}

\newlength{\toclineskip}
\setlength{\toclineskip}{\baselineskip}

\newcounter{hind}

% Create line with dots
\newcommand{\filldots}{\xleaders\hbox{*}\hfill}

\newcommand{\scnsupergroupsign}{\textasciicircum}
\newcommand{\scnrolesign}{\,$^\prime$}

\newcommand{\calctab}{\dimexpr (\tabsize)*\value{hind} \relax}
\newcommand{\settab}{\setlength{\parindent}{\calctab}}
\newcommand{\sethind}[1][0em]{\setlength{\hangindent}{\calctab+\tabsize+#1}}
\newcommand{\calcdiff}[1]{\dimexpr \tabsize-#1  \relax}
\newcommand{\makediff}[1]{\hspace{\calcdiff{#1}}}

\RequirePackage{microtype}
\newcommand{\textspaced}[1]{%
    \textls[200]{#1}
}


\RequirePackage{amsmath,bm}

\newcommand{\scnstartstruct}{%
    \settab
    \par$\pmb{=\{}$\par
}

\newcommand{\scnstartsubstruct}{%
    \settab
    \par$\pmb{\supset=}$\\
    $\pmb{\{}$\par
}

\newcommand{\scnstartset}{%
    \par$\pmb{\{}$\par
}

\newcommand{\scnendstruct}{%
    \par$\pmb{\}}$\par
}

\newcommand{\scnstartvector}{%
    \par$\pmb{\langle}$\par
}

\newcommand{\scnendvector}{%
    \par$\pmb{\rangle}$\par
}

\newcommand{\scnstarthierstruct}{%
    \par$\pmb{\langle|}$\par
}

\newcommand{\scnendhierstruct}{%
    \par$\pmb{|\rangle}$\par
}

%DEFINES END

\RequirePackage{tocloft}
\makeatletter
\renewcommand{\@cftmaketoctitle}{}
\makeatother
\renewcommand{\cftchapfont}{\bfseries}
\renewcommand{\cftsecfont}{\bfseries}
\renewcommand{\cftsubsecfont}{\bfseries}
\renewcommand{\cftpartleader}{\cftdotfill{\cftdotsep}}
\renewcommand{\cftchapleader}{\cftdotfill{\cftdotsep}}
\renewcommand{\cftsecleader}{\cftdotfill{\cftdotsep}}
\renewcommand{\cftsubsecleader}{\cftdotfill{\cftdotsep}}
\renewcommand{\cftsubsubsecleader}{\cftdotfill{\cftdotsep}}

\makeatletter
\renewcommand{\cftchappresnum}{\begin{lrbox}{\@tempboxa}}
\renewcommand{\cftchapaftersnum}{\end{lrbox}}
\cftsetindents{chapter}{0pt}{0pt}
\renewcommand{\cftsecpresnum}{\begin{lrbox}{\@tempboxa}}
\renewcommand{\cftsecaftersnum}{\end{lrbox}}
\cftsetindents{section}{\tabsize}{0pt}
\renewcommand{\cftsubsecpresnum}{\begin{lrbox}{\@tempboxa}}
\renewcommand{\cftsubsecaftersnum}{\end{lrbox}}
\cftsetindents{subsection}{6em}{0pt}
\renewcommand{\cftsubsubsecpresnum}{\begin{lrbox}{\@tempboxa}}
\renewcommand{\cftsubsubsecaftersnum}{\end{lrbox}}
\cftsetindents{subsubsection}{9em}{0pt}
\renewcommand{\cftparapresnum}{\begin{lrbox}{\@tempboxa}}
\renewcommand{\cftparaaftersnum}{\end{lrbox}}
\cftsetindents{paragraph}{12em}{0pt}
\renewcommand{\cftsubparapresnum}{\begin{lrbox}{\@tempboxa}}
\renewcommand{\cftsubparaaftersnum}{\end{lrbox}}
\cftsetindents{subparagraph}{15em}{0pt}
\renewcommand\cftchapafterpnum{\vspace{\toclineskip}}
\renewcommand\cftsecafterpnum{\vspace{\toclineskip}}
\renewcommand\cftsubsecafterpnum{\vspace{\toclineskip}}
\renewcommand\cftsubsubsecafterpnum{\vspace{\toclineskip}}
\renewcommand\cftparaafterpnum{\vspace{\toclineskip}}
\renewcommand\cftsubparaafterpnum{\vspace{\toclineskip}}
\makeatother

%SCN START

\newcommand{\scnheader}[1]{%
    \setlength{\hangindent}{0em}
    \par\textit{\textbf{#1}}\par
}

\newcommand{\scnstructheader}[1]{%
    \setlength{\hangindent}{0em}
    \par\textit{\textbf{\textspaced{#1}}}\par
}

\newcommand{\scnheaderlocal}[1]{%
    \settab\textit{\textbf{#1}}\par
}

\newcommand{\scnstructheaderlocal}[1]{%
    \settab\textit{\textbf{\textspaced{#1}}}\par
}

\newcommand{\scnstructidtf}[1]{%
    \textit{\textspaced{#1}}
}

\newcommand{\scnkeyword}[1]{%
    \textit{\textbf{#1}}
}

\newcommand{\scnsectionheader}[1]{%
    \textspaced{\scnheader{\large #1}}
}

\makeatletter
\newcommand{\scnsegmentheader}[1]{%
    \bigskip
    \normalfont\bfseries /*~\textspaced{Сегмент}~%
    \filldots/%
    \normalfont\textspaced{\scnheader{#1}}\par
}
\makeatother

\newcommand{\scnrel}[1]{%
    \settab\sethind%
    \textit{#1}*{\normalfont:~}\par
}

\newcommand{\scnvarrel}[1]{%
    \settab\sethind%
    \textit{#1}*{\normalfont::~}\par
}

\newcommand\scnrolerel[1]{%
    \settab\sethind%
    \textit{#1}\scnrolesign{\normalfont:~}\par
}

\newcommand\scnvarrolerel[1]{%
    \settab\sethind%
    \textit{#1}\scnrolesign{\normalfont::~}\par
}

\RequirePackage{calc}
\RequirePackage{changepage}
\RequirePackage{ragged2e}

\newcommand{\scnfilelong}[1]{
    \begin{adjustwidth}{\calctab}{0em}
        \justify
        \setlength{\parindent}{0em}
        \setlength{\itemindent}{0em}
        \setlength{\parskip}{0em}
        \normalfont\textbf{[}#1\textbf{]}
    \end{adjustwidth}
}

\RequirePackage{tabularx}
\RequirePackage{graphicx}
\RequirePackage{colortbl}

\newcommand{\scnfileimage}[1]{
    \begin{adjustwidth}{\calctab}{0em}
        \setlength{\parindent}{0em}
        \setlength{\itemindent}{0em}
        \setlength{\parskip}{0em}
        \normalfont\textbf{[}
        \cellcolor{white}
        \begin{center}
            \includegraphics[width=(\textwidth-\calctab)]{#1}
        \end{center}
        \textbf{]}
    \end{adjustwidth}
}

\newcommand{\scnrelfrom}[2]{%
    \settab$\bm{\Rightarrow}$\makediff{\arrowsize}\scnrel{#1}
    \begin{scnlevel}
        \settab\sethind%
        {\itshape #2}
    \end{scnlevel}
    \par
}

\newcommand{\scnrelsuperset}[2]{%
    \settab$\bm{\supset}$\makediff{\subsetsize}\scnrel{#1}
    \begin{scnlevel}
        \sethind\settab
        {\itshape #2}
    \end{scnlevel}
    \par
}

\newcommand{\scnvarrelfrom}[2]{%
    \settab\textunderscore$\bm{\Rightarrow}$\makediff{\arrowsizevar}\scnvarrel{#1}
    \begin{scnlevel}
        \sethind\settab
        {\itshape #2}
    \end{scnlevel}
    \par
}

\newcommand{\scnrelto}[2]{%
    \settab$\bm{\Leftarrow}$\makediff{\arrowsize}\scnrel{#1}
    \begin{scnlevel}
        \sethind\settab
        {\itshape #2}
    \end{scnlevel}
    \par
}

\newcommand{\scnvarrelto}[2]{%
    \settab\textunderscore$\bm{\Leftarrow}$\makediff{\arrowsizevar}\scnvarrel{#1}
    \begin{scnlevel}
        \sethind\settab
        {\itshape #2}
    \end{scnlevel}
    \par
}

\newcommand{\scnrelboth}[2]{%
    \settab$\bm{\Leftrightarrow}$\makediff{\arrowsize}\scnrel{#1}
    \begin{scnlevel}
        \sethind\settab
        {\itshape #2}
    \end{scnlevel}
    \par
}

\newcommand{\scneq}[1]{%
    \settab\sethind$\bm{=}$\makediff{\eqsize}\textit{#1}\par
}

\newcommand{\scneqfile}[1]{%
    \settab$\bm{=}$\\ 
    \scnfilelong{#1}\par
}

\newcommand{\scneqimage}[1]{%
    \settab$\bm{=}$\\
    \scnfileimage{#1}\par
}

\RequirePackage[table]{xcolor}

\newcommand{\scnfiletable}[1]{
    \begin{adjustwidth}{\calctab}{0em}
        \setlength{\parindent}{0em}
        \setlength{\itemindent}{0em}
        \setlength{\parskip}{0em}
        \normalfont\textbf{[}
        \rowcolors{1}{white}{white}
        #1
        \textbf{]}
    \end{adjustwidth}
}

\newcommand{\scneqtable}[1]{%
    \settab$\bm{=}$\\ 
    \scnfiletable{#1}\par
}

\newcommand{\scnfileclass}[1]{%
    \normalfont![~#1~]!
}

\newcommand{\scneqfileclass}[1]{%
    \settab\sethind$\bm{=}$\makediff{\eqsize}\scnfileclass{#1}\par
}

\newcommand{\scnsubset}[1]{%
    \settab\sethind$\bm{\subset}$\makediff{\subsetsize}\textit{#1}\par
}

\newcommand{\scnnotsubset}[1]{%
    \settab\sethind$\bm{\not\subset}$\makediff{\subsetsize}\textit{#1}\par
}

\newcommand{\scnsuperset}[1]{%
    \settab\sethind$\bm{\supset}$\makediff{\subsetsize}\textit{#1}\par
}

\newcommand{\scniselement}[1]{%
    \settab\sethind$\bm{\in}$\makediff{\insize}\textit{#1}\par
}

\newcommand{\scnisvarelement}[1]{%
	\settab\sethind\textunderscore$\bm{\in}$\makediff{\insizevar}\textit{#1}\par
}

\newcommand{\scnhaselement}[1]{%
    \settab\sethind$\bm{\ni}$\makediff{\insize}\textit{#1}\par
}

\newcommand{\scnhasvarelement}[1]{%
    \settab\settab\textunderscore$\bm{\ni}$\makediff{\insizevar}\textit{#1}\par
}

\newcommand{\scnhaselementrole}[2]{%
    \settab$\bm{\ni}$\makediff{\insize}\scnrolerel{#1}
    \begin{scnlevel}
        \settab\sethind%
        \textit{#2}
    \end{scnlevel}
    \par
}

\newcommand{\scnhasvarelementrole}[2]{%
	\settab\textunderscore$\bm{\ni}$\makediff{\insizevar}\scnvarrolerel{#1}
	\begin{scnlevel}
	    \settab\sethind%
	    \textit{#2}
	\end{scnlevel}
	\par
}

\newcommand{\scniselementrole}[2]{%
    \settab$\bm{\in}$\makediff{\insize}\scnrolerel{#1}
    \begin{scnlevel}
        \settab\sethind%
        \textit{#2}
    \end{scnlevel}
    \par
}

\RequirePackage{mathtools}

\newcommand{\scnidtf}[1]{%
    \settab\sethind$\bm{\coloneqq}$\makediff{\coloneqsize}[#1]\par
}

\newcommand{\scnidtftext}[2]{%
    \settab$\bm{\coloneqq}$\makediff{\coloneqsize}\scnrel{#1}
    \begin{scnlevel}
        \scnfilelong{#2}
    \end{scnlevel}
    \par
}

\newcommand{\scnidtfdef}[1]{%
    \scnidtftext{определение}{#1}
}

\newcommand{\scnidtfexp}[1]{%
    \scnidtftext{пояснение}{#1}
}

\newcommand{\scntext}[2]{%
    \settab$\bm{\Rightarrow}$\makediff{\arrowsize}\scnrel{#1}
    \begin{scnlevel}
        \sethind\settab
        \scnfilelong{#2}
    \end{scnlevel}
    \par
}

\newcommand{\scncomment}[1]{%
    \scntext{комментарий}{#1}
}

\newcommand{\scnexplanation}[1]{%
    \scntext{пояснение}{#1}
}

\newcommand{\scnnote}[1]{%
    \scntext{примечание}{#1}
}

\newcommand{\scndefinition}[1]{%
    \scntext{определение}{#1}
}

\newcommand{\scnevolution}[1]{%
    \scntext{эволюция}{#1}
}

\newcommand{\scnproblems}[1]{%
    \scntext{проблемы}{#1}
}

\newcommand{\scnevolutiondirections}[1]{%
    \scntext{направления эволюции}{#1}
}

\newcommand{\scnevolutionproblems}[1]{%
    \scntext{проблемы развития}{#1}
}

\newcommand{\scnmodernstate}[1]{%
    \scntext{современное состояние}{#1}
}

\newcommand{\scnsolutionapproach}[1]{%
    \scntext{предлагаемый подход к решению}{#1}
}

\newcommand{\scnadvantages}[1]{%
    \scntext{достоинства}{#1}
}

\newcommand{\scnprinciples}[1]{%
    \scntext{принципы}{#1}
}

\newcommand{\scnspheresapplication}[1]{%
    \scntext{сферы применения}{#1}
}

\newcommand{\scnseminclusion}[1]{%
    \scntext{семантическое включение}{#1}
}

\newcommand{\scneditor}[1]{%
    \scnrelfrom{редактор}{#1}
}

%Subject domains
\newcommand{\scnsdmainclass}[1]{%
    \scnhaselement{максимальный класс объектов исследования}{#1}
}

\newcommand{\scnsdmainclasssingle}[1]{%
    \scnhaselementrole{максимальный класс объектов исследования}{#1}
}

\newcommand{\scnsdclass}[1]{%
    \scnhaselement{класс объектов исследования}{#1}
}

\newcommand{\scnsdrelation}[1]{%
    \scnhaselement{исследуемое отношение}{#1}
}

%Developer info

\newcommand{\scnsourcecomment}[1]{%
    \begin{adjustwidth}{\calctab}{0em}
        \justify
        \setlength{\parindent}{0em}
        \setlength{\itemindent}{0em}%
        \normalfont /*~#1{}~*/
    \end{adjustwidth}
}

\newcommand{\scnendcurrentsectioncomment}{%
    \scnsourcecomment{Завершили раздел ``\textit{\currentname}''}
}

\newcommand{\scnendsegmentcomment}[1]{%
	\scnsourcecomment{Завершили Сегмент ``\textit{#1}''}
}

%Sections START

\RequirePackage{nameref}

\RequirePackage[pagestyles]{titlesec}

\titleformat{\chapter}[display]{\normalfont\bfseries}{}{0pt}{\normalsize}

\titleformat{\section}[display]{\normalfont\bfseries}{}{0pt}{\normalsize}

\titleformat{\subsection}[display]{\normalfont\bfseries}{}{0pt}{\normalsize}

\titleformat{\subsubsection}[display]{\normalfont\bfseries}{}{0pt}{\normalsize}

\titleformat{\paragraph}[display]{\normalfont\bfseries}{}{0pt}{\normalsize}

\titlespacing*{\chapter}
{0em}{0em}{0em}
\titlespacing*{\section}
{0em}{0em}{0em}
\titlespacing*{\subsection}
{0em}{0em}{0em}
\titlespacing*{\subsubsection}
{0em}{0em}{0em}
\titlespacing*{\paragraph}
{0em}{0em}{0em}


\newcommand{\scsectionfamily}[2][]{%
    \clearpage\chapter{
    /*~\textspaced{\large Семейство разделов}~\filldots/
    }
    \scnsectionheader{#1}
    \ifx&#1&
    \else
	\addtocontents{toc}{
	\vspace{\dimexpr -\toclineskip-0.4\baselineskip \relax}
	\parbox{\textwidth}
	{\protect#1}
	\vspace{\toclineskip}
	}
	\fi
}

\newcommand{\scchapter}[2][]{
    \clearpage\chapter[\textit{#2}]{
    /*~\textspaced{\large Раздел}~
    \filldots/
    }
    \ifx&#1&
    \else
    \addtocontents{toc}{
    \vspace{\dimexpr -\toclineskip-0.4\baselineskip \relax}
    \parbox{\textwidth}
    {\protect#1}
    \vspace{\toclineskip}
    }
    \fi
}

\newcommand{\scsection}[2][]{
    \clearpage\section[\textit{#2}]{
    /*~\textspaced{\large Раздел}~
    \filldots/
    }
    \ifx&#1&
    \else
    \addtocontents{toc}{
    \vspace{\dimexpr -\toclineskip+0.1\baselineskip \relax}
    \parbox{\textwidth}
    {\begin{adjustwidth}{\tabsize}{0em}
        \protect#1
    \end{adjustwidth}}
    \vspace{\toclineskip}
    }
    \fi
}

\newcommand{\scseparatedfragment}[2][]{
    \clearpage\chapter[\textit{#2}]{
    /*\filldots/
    }
    \ifx&#1&
    \else
    \addtocontents{toc}{
    \vspace{\dimexpr -\toclineskip-0.4\baselineskip \relax}
    \parbox{\textwidth}
    {\protect#1}
    \vspace{\toclineskip}
    }
    \fi
}

\newcommand\scsubsection[2][]{
    \clearpage\subsection[\textit{#2}]{
    /*~\textspaced{\large Раздел}~
    \filldots/
    }
    \ifx&#1&
    \else
    \addtocontents{toc}{
    \vspace{\dimexpr -\toclineskip+0.1\baselineskip \relax}
    \parbox{\textwidth}
    {\begin{adjustwidth}{\tabsize+\tabsize}{0em}
        \protect#1
    \end{adjustwidth}}
    \vspace{\toclineskip}
    }
    \fi
}

\newcommand{\scsubsubsection}[2][]{
    \clearpage\subsubsection[\textit{#2}]{
    /*~\textspaced{\large Раздел}~
    \filldots/
    }
    \ifx&#1&
    \else
    \addtocontents{toc}{
    \vspace{\dimexpr -\toclineskip+0.1\baselineskip \relax}
    \parbox{\textwidth}
    {\begin{adjustwidth}{\tabsize+\tabsize+\tabsize}{0em}
        \protect#1
    \end{adjustwidth}}
    \vspace{\toclineskip}
    }
    \fi
}

\newcommand{\scparagraph}[2][]{
    \clearpage\paragraph[\textit{#2}]{
    /*~\textspaced{\large Раздел}~
    \filldots/
    }
    \ifx&#1&
    \else
    \addtocontents{toc}{
    \vspace{\dimexpr -\toclineskip+0.1\baselineskip \relax}
    \parbox{\textwidth}
    {\begin{adjustwidth}{\tabsize+\tabsize+\tabsize+\tabsize}{0em}
        \protect#1
    \end{adjustwidth}}
    \vspace{\toclineskip}
    }
    \fi
}

\makeatletter
\newcommand*{\currentname}{\@currentlabelname}
\makeatother

%Sections END

% Itemize START

\RequirePackage{enumitem}
\RequirePackage{amssymb}

\newenvironment{scnitemize}{
    \begin{itemize}[
    leftmargin=\leftmargin-1em+\bracketsize,
    itemsep=-0.25em,
    before=\vspace{-0.8em},
    after=\vspace{-0.5em}
    ]
    \renewcommand{\labelitemi}{\scriptsize$\square$}
    \renewcommand{\labelitemii}{\scriptsize$\square~\square$}
    \renewcommand{\labelitemiii}{\scriptsize$\square~\square~\square$} 
}{
    \end{itemize}
}

\newenvironment{scnitemizeii}{
    \begin{itemize}[
    leftmargin=\leftmargin-1em+\bracketsize+\squaresize,
    itemsep=-0.25em,
    before=\vspace{-0.3em},
    after=\vspace{0em}
    ]
    \renewcommand{\labelitemi}{\scriptsize$\square~\square$} 
}{
    \end{itemize}
}

\newenvironment{scnitemizeiii}{
    \begin{itemize}[
    leftmargin=\leftmargin-1em+\bracketsize+\doublesquaresize,
    itemsep=-0.25em,
    before=\vspace{-0.3em},
    after=\vspace{0em}
    ]
    \renewcommand{\labelitemi}{\scriptsize$\square~\square$} 
}{
    \end{itemize}
}

\newenvironment{scnenumerate}{
    \begin{enumerate}[
    leftmargin=\leftmargin-1em+\bracketsize,
    itemsep=-0.25em,
    before=\vspace{-0.8em},
    after=\vspace{-0.5em}
    ]
}{
    \end{enumerate}
}

% Itemize END

% Background START

\RequirePackage[pages=all]{background}
\RequirePackage{tikz}
\usetikzlibrary{calc} 
\RequirePackage{layout}

\newcommand{\drawvlines}{
\begin{tikzpicture}[remember picture,overlay]

\coordinate (NW) at ([
            xshift=0.36in,
            yshift=-1.1in-2\voffset-\topmargin-\headheight-\headsep,
        ]current page.north west);
        
\coordinate (SW) at ([
            xshift=0.36in,
            yshift=-1.1in-2\voffset-\topmargin-\headheight-\headsep-\textheight,
        ]current page.north west);

\foreach \i in {1,2,...,18}{
\draw[black!50] ($(NW)+(\i*\tabsize,0)$) -- ($(SW)+(\i*\tabsize,0)$);}

\end{tikzpicture}
}

\newcommand\DeactivateBG{\backgroundsetup{contents={}}}
\newcommand\ActivateBG{\backgroundsetup{contents={\drawvlines}}}

\backgroundsetup{
scale=1,
color=black,
opacity=1.0,
angle=0
}

% Background END

\newcommand{\scnqq}[1]{"#1"{}}

\newcommand{\scnqqi}[1]{``#1''}

% ENVIRONMENTS Start

\newenvironment{SCn}{%
    \setcounter{hind}{0}% 
    \setlength{\parskip}{0em}
    \begin{flushleft}
}{%
    \end{flushleft}
}

\newenvironment{scnlevel}
{\addtocounter{hind}{1}}
{\addtocounter{hind}{-1}}

\newenvironment{scnlist}{%
    \providecommand{\scnitem}[1]{%
        \settab
        \sethind
        \par$\bullet$\makediff{\bulletsize}\textit{##1}\par
    }
    \renewcommand{\scnitem}[1]{%
        \settab
        \sethind
        \par$\bullet$\makediff{\bulletsize}\textit{##1}\par
    }
}{}

\newenvironment{scnlistset}{%
    \providecommand{\scnitem}[1]{%
        \settab
        \sethind
        \par$\bullet$\makediff{\bulletsize}\textit{##1}\par
    }
    \renewcommand{\scnitem}[1]{%
        \setlength{\parindent}{\calctab+\bulletsize}
        \sethind
        \par$\bullet$\makediff{\bulletbracketsize}\textit{##1}\par
    }
}{}

\newenvironment{scnrelfromlist}[1]{%
    \settab$\bm{\Rightarrow}$\makediff{\arrowsize}\scnrel{#1}
    \begin{scnlevel}%
        \begin{scnlist}%
}{
        \end{scnlist}
    \end{scnlevel}
}


\newenvironment{scnreltolist}[1]{%
    \settab$\bm{\Leftarrow}$\makediff{\arrowsize}\scnrel{#1}
    \begin{scnlevel}
        \begin{scnlist}
}{
        \end{scnlist} 
    \end{scnlevel}
}

\newenvironment{scnrelbothlist}[1]{%
    \settab$\bm{\Leftrightarrow}$\makediff{\arrowsize}\scnrel{#1}
    \begin{scnlevel}
        \begin{scnlist}
}{
        \end{scnlist} 
    \end{scnlevel}
}

\RequirePackage{xparse}
\NewDocumentEnvironment{set}{mm}
{#1}
{#2}

\newenvironment{scnstruct}
{\begin{set}{\scnstartstruct}{\scnendstruct}}
{\end{set}}

\newenvironment{scnsubstruct}
{\begin{set}{\scnstartsubstruct}{\scnendstruct}}
{\end{set}}

\newenvironment{scnset}
{\begin{set}{\scnstartset}{\scnendstruct}}
{\end{set}}

\newenvironment{scnvector}
{\begin{set}{\scnstartvector}{\scnendvector}}
{\end{set}}

\newenvironment{scnhierstruct}
{\begin{set}{\scnstarthierstruct}{\scnendhierstruct}}
{\end{set}}

\newenvironment{scnrelfromset}[1]{%
    \settab$\bm{\Rightarrow}$\makediff{\arrowsize}\scnrel{#1}
    \begin{scnlevel}
        \settab
        \begin{scnset}
            \vspace{-\baselineskip}
            \begin{scnlistset}
}{
            \end{scnlistset}
            \settab
        \end{scnset}
    \end{scnlevel}
}

\newenvironment{scnrelfromvector}[1]{%
    \settab$\bm{\Rightarrow}$\makediff{\arrowsize}\scnrel{#1}
    \begin{scnlevel}
        \settab
        \begin{scnvector}
            \vspace{-\baselineskip}
            \begin{scnlistset}
}{
            \end{scnlistset}
            \settab
        \end{scnvector}
    \end{scnlevel}
}

\newenvironment{scnreltoset}[1]{%
    \settab$\bm{\Leftarrow}$\makediff{\arrowsize}\scnrel{#1}
    \begin{scnlevel}
        \settab
        \begin{scnset}
            \vspace{-\baselineskip}
            \begin{scnlistset}
}{
            \end{scnlistset}
            \settab
        \end{scnset}
    \end{scnlevel}
}

\newenvironment{scnreltovector}[1]{%
    \settab$\bm{\Leftarrow}$\makediff{\arrowsize}\scnrel{#1}
    \begin{scnlevel}
        \settab
        \begin{scnvector}
            \vspace{-\baselineskip}
            \begin{scnlistset}
}{
            \end{scnlistset}
            \settab
        \end{scnvector}
    \end{scnlevel}
}

\newenvironment{scnhaselementset}{%
    \settab$\bm{\ni}$
    \begin{scnlevel}
        \settab
        \vspace{-\baselineskip}
        \begin{scnset}
            \vspace{-\baselineskip}
            \begin{scnlistset}
}{
            \end{scnlistset}
            \settab
        \end{scnset}
    \end{scnlevel}
}

\newenvironment{scnhaselementvector}{%
    \settab$\bm{\ni}$%
    \begin{scnlevel}%
        \settab
        \vspace{-\baselineskip}
        \begin{scnvector}
            \vspace{-\baselineskip}
            \begin{scnlistset}
}{
            \end{scnlistset}
            \settab
        \end{scnvector}
    \end{scnlevel}
}

\newenvironment{scneqtoset}{%
    \settab$\bm{=}$%
    \begin{scnlevel}%
        \settab
        \vspace{-\baselineskip}
        \begin{scnset}
            \vspace{-\baselineskip}
            \begin{scnlistset}
}{
            \end{scnlistset}
            \settab
        \end{scnset}
    \end{scnlevel}
}

\newenvironment{scneqtovector}{%
    \settab$\bm{=}$%
    \begin{scnlevel}%
        \settab
        \vspace{-\baselineskip}
        \begin{scnvector}
            \vspace{-\baselineskip}
            \begin{scnlistset}
}{
            \end{scnlistset}
            \settab
        \end{scnvector}
    \end{scnlevel}
}

\newenvironment{scnhassubstruct}{%
    \settab$\bm{\supset=}$%
    \begin{scnlevel}%
        \settab
        \vspace{-\baselineskip}
        \begin{scnset}
            \vspace{-\baselineskip}
            \begin{scnlistset}
}{
            \end{scnlistset}
            \settab
        \end{scnset}
    \end{scnlevel}
}

\newenvironment{scnsubdividing}{%
    \begin{scnrelfromset}{разбиение}
}{
    \end{scnrelfromset}
}

% ENVIRONMENTS End

\RequirePackage{expl3}
\RequirePackage{etoolbox}
\RequirePackage[
style=ieee,
citestyle=authoryear,
maxnames=3
]{biblatex}


\ExplSyntaxOn

\clist_new:N \scncitenames
\prop_new:N \scncitelist

\NewDocumentCommand \addcite {m m} 
{
    \prop_if_in:NnTF \scncitelist {#1}{}{
        \prop_gput:NnV \scncitelist {#1}{#2}
        \clist_gput_right:Nn \scncitenames {#1}
    }
}
\NewDocumentCommand \printscnbiblio {} 
{
    \clist_sort:Nn \scncitenames
    {
        \ifnumcomp{\pdfstrcmp{##1}{##2}}{>}{0}
        { \sort_return_swapped: }
        { \sort_return_same: }
    }
    \clist_map_inline:Nn \scncitenames {\prop_item:Nn \scncitelist {##1}}
}
\ExplSyntaxOff

\newcommand{\scncite}[1]{
\scncitecommon{#1}{\cite{#1}}
}

\newcommand{\scncitecommon}[2]{
\hspace{-0.6em}\textit{#2}\hspace{-0.8em}
\addcite{#2}{\printscncite{#1}{#2}}
}

\newcommand{\printscncite}[2]{
\scnheader{#2}
\scntext{библиографическая ссылка}{\fullcite{#1}}
}

\newcommand{\scnciteannotation}[1]{
	\scntext{аннотация}{\citefield{#1}{annotation}}
}

\endinput

